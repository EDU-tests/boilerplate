

import chalk from "chalk";

// import PrismaModule from "prisma-module";

// import CoreModule from "../modules";

import fs from "fs";

const { parse, print } = require('graphql');

// const core = new CoreModule();


const generateSchema = function (schemaType, coreModule, basePath) {

  let schema;


  switch (schemaType) {

    case "prisma":

      schema = coreModule.getSchema();

      // console.log(chalk.green("schema"), schema);


      const parsed = parse(schema);

      parsed.definitions = parsed.definitions.filter(
        n => n.kind !== "SchemaDefinition" && !(
          n.kind === "ObjectTypeDefinition" && ["Query", "Mutation", "Subscription"].indexOf(n.name.value) !== -1)
      );

      schema = print(parsed);

      console.log(chalk.green("schema"), schema);

      fs.writeFileSync(basePath + "/prisma/generated.graphql", schema);

      break;


    case "api":

      schema = coreModule.getApiSchema();

      console.log(chalk.green("schema"), schema);

      fs.writeFileSync(basePath + "/generated/api.graphql", schema);


      break;

    default: throw new Error("Env schemaType is wrong or not defined");

  }

}

export default generateSchema;
